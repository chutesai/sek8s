- name: Configure cosign
  block:
    - name: Apply registry configuration
      ansible.builtin.copy:
        src: cosign-registries.json
        dest: /etc/admission-controller/cosign-registries.json
        owner: root
        group: root
        mode: '0644'
      notify: restart admission-controller

    - name: Create cosign directory for admission controller
      ansible.builtin.file:
        path: /etc/admission-controller/cosign
        state: directory
        owner: root
        group: admission
        mode: '0750'

    - name: Setup cosign key
      ansible.builtin.copy:
        src: "{{ cosign_public_key_path }}"
        dest: /etc/admission-controller/cosign/cosign.pub
        owner: root
        group: admission
        mode: '0640'
      notify: restart admission-controller